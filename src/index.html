<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>CLIQSHOP - Modern Minimal Fashion</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="icon" type="image/x-icon" href="cliqshop.ico">
  
  <!-- Preload Font Awesome resources -->
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/fonts/fontawesome-webfont.woff2" as="font" type="font/woff2" crossorigin>
  
  <!-- CRITICAL FIX: Anti-shrink dashboard layout -->
  <style id="critical-dashboard-fix">
    /* Dashboard anti-shrink flex layout - ensures proper sizing */
    body.admin-view,
    app-root,
    app-admin-layout,
    .admin-layout,
    .admin-content,
    .admin-main,
    app-admin-dashboard,
    .dashboard,
    .stable-content {
      display: flex !important;
      flex-direction: column !important;
      flex: 1 1 auto !important;
      min-height: 0 !important; /* Critical for nested flex containers */
      box-sizing: border-box !important;
      width: 100% !important;
      max-width: 100% !important;
    }
    
    /* Fixed positioning for admin layout */
    app-admin-layout {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      bottom: 0 !important;
      height: 100vh !important;
      width: 100vw !important;
      overflow: hidden !important;
    }
    
    /* Admin layout grid setup */
    .admin-layout {
      display: grid !important;
      grid-template-columns: 280px 1fr !important;
      height: 100vh !important;
      overflow: hidden !important;
    }
    
    /* Admin content area - ensure proper sizing and scroll */
    .admin-content {
      margin-left: 280px !important;
      width: calc(100vw - 280px) !important;
      overflow-y: auto !important;
    }
    
    /* Main content area */
    .admin-main {
      overflow-y: auto !important;
      height: calc(100vh - 80px) !important;
      padding: 30px !important;
    }
    
    /* Dashboard component */
    app-admin-dashboard {
      min-height: auto !important;
    }
    
    /* Dashboard container */
    .dashboard {
      height: auto !important;
      overflow-y: visible !important;
      padding: 20px !important;
    }
    
    /* Stats grid */
    .stats-grid {
      display: grid !important;
      grid-template-columns: repeat(3, 1fr) !important;
      gap: 30px !important;
      width: 100% !important;
      flex-shrink: 0 !important;
    }
    
    /* Hide emergency fallback dashboard */
    .emergency-dashboard {
      display: none !important;
    }
    
    /* Mobile overrides */
    @media (max-width: 992px) {
      .admin-layout {
        grid-template-columns: 0 1fr !important;
      }
      
      .admin-content {
        margin-left: 0 !important;
        width: 100% !important;
      }
    }
    
    @media (max-width: 768px) {
      .stats-grid {
        grid-template-columns: 1fr !important;
      }
    }
  </style>
  
  <!-- Font Awesome for icons - with redundant CDNs for reliability -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Font Awesome 4 compatibility -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- Backup font awesome from alternative CDN -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.4.0/css/all.css" integrity="sha384-iw3OoTErCYJJB9mCa8LNS2hbsQ7M3C0EpIsO/H5+EGAkPGc6rk+V8i/oYgGe7Hdh" crossorigin="anonymous">
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
  
  <!-- Font awesome icon fix script -->
  <script>
    (function() {
      // Check if Font Awesome icons are loaded properly
      window.addEventListener('DOMContentLoaded', function() {
        setTimeout(function() {
          var testIcon = document.createElement('i');
          testIcon.className = 'fa fa-shopping-cart';
          testIcon.style.display = 'none';
          document.body.appendChild(testIcon);
          
          var styles = window.getComputedStyle(testIcon);
          var fontFamily = styles.getPropertyValue('font-family');
          
          if (fontFamily.indexOf('FontAwesome') === -1 && fontFamily.indexOf('Font Awesome') === -1) {
            console.warn('Font Awesome not loaded correctly, attempting to fix...');
            
            // Reload from local fallback if available
            var localFallback = document.createElement('link');
            localFallback.rel = 'stylesheet';
            localFallback.href = '/assets/fontawesome/css/all.min.css';
            document.head.appendChild(localFallback);
            
            // Or try one more CDN
            var backupLink = document.createElement('link');
            backupLink.rel = 'stylesheet';
            backupLink.href = 'https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css';
            document.head.appendChild(backupLink);
          }
          
          document.body.removeChild(testIcon);
        }, 1000);
      });
    })();
  </script>

  <style>
    /* Critical CSS to ensure components are visible */
    app-root, app-admin-layout, app-admin-dashboard, 
    app-admin-product-list, app-admin-order-list {
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
      width: 100% !important;
      min-height: 100px !important;
    }
    
    /* Make sure all Angular-generated content is visible */
    [_ngcontent-*], [_nghost-*] {
      visibility: visible !important;
      display: block !important;
      opacity: 1 !important;
    }
    
    /* ZARA-inspired Admin styles */
    body.admin-view {
      font-family: 'Inter', sans-serif;
      overflow: hidden;
      padding: 0;
      margin: 0;
      color: #000;
      background-color: #fff;
      letter-spacing: 0.02em;
      line-height: 1.5;
      font-size: 14px;
    }
    
    /* Admin layout styles */
    body.admin-view .admin-layout {
      display: grid;
      grid-template-columns: 280px 1fr;
      width: 100%;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      overflow: hidden;
    }
    
    body.admin-view .admin-sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 280px;
      height: 100vh;
      background-color: #000;
      color: #fff;
      overflow-y: auto;
      padding: 40px 0;
      z-index: 100;
    }
    
    body.admin-view .admin-content {
      margin-left: 280px;
      width: calc(100% - 280px);
      height: 100vh;
      background-color: #fff;
      overflow-y: auto;
      z-index: 50;
      display: flex;
      flex-direction: column;
    }
    
    body.admin-view .admin-header {
      padding: 30px 40px;
      background-color: #fff;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 60;
    }
    
    body.admin-view .admin-main {
      flex: 1;
      padding: 40px;
      background-color: #fff;
      overflow-y: auto;
      width: 100%;
      box-sizing: border-box;
    }

    /* Ensure dashboard components are visible and styled correctly */
    body.admin-view .dashboard {
      width: 100% !important;
      max-width: 100% !important;
      box-sizing: border-box !important;
      display: flex !important;
      flex-direction: column !important;
      visibility: visible !important;
      padding: 20px !important;
      background-color: #fff !important;
      color: #000 !important;
    }

    body.admin-view .dashboard .stats-grid {
      display: grid !important;
      grid-template-columns: repeat(3, 1fr) !important;
      gap: 30px !important;
      width: 100% !important;
      margin-bottom: 50px !important;
    }

    body.admin-view .dashboard .recent-orders {
      display: block !important;
      width: 100% !important;
      visibility: visible !important;
      border: 1px solid #eee !important;
      padding: 30px !important;
      margin-bottom: 40px !important;
    }

    body.admin-view .dashboard .stats-card {
      display: flex !important;
      flex-direction: column !important;
      align-items: center !important;
      justify-content: center !important;
      padding: 40px 30px !important;
      border: 1px solid #eee !important;
      background-color: #fff !important;
      visibility: visible !important;
    }

    /* Product list styles */
    body.admin-view .product-list {
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
      display: block !important;
      visibility: visible !important;
      padding: 20px !important;
      background-color: #fff !important;
      color: #000 !important;
    }

    /* Responsive for smaller screens */
    @media (max-width: 1200px) {
      body.admin-view .admin-main {
        padding: 20px;
      }
    }

    /* Hide non-admin components when in admin view */
    body.admin-view app-header,
    body.admin-view app-footer,
    body.admin-view .main-content {
      display: none;
    }

    /* Added new utility classes to fix visibility issues */
    .force-visible {
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
    }
    
    .force-grid {
      display: grid !important;
      visibility: visible !important;
      opacity: 1 !important;
    }
    
    .force-flex {
      display: flex !important;
      visibility: visible !important;
      opacity: 1 !important;
    }

    /* Critical dashboard styles to prevent content shrinking */
    app-admin-dashboard, 
    .admin-main, 
    .dashboard {
      min-height: calc(100vh - 140px) !important;
      height: auto !important;
      display: block !important;
      width: 100% !important;
    }
    
    /* Hide emergency dashboard */
    .emergency-dashboard {
      display: none !important;
      visibility: hidden !important;
    }
    
    /* Force stats grid to maintain layout */
    .stats-grid {
      display: grid !important;
      grid-template-columns: repeat(3, 1fr) !important;
      min-height: 200px !important;
      width: 100% !important;
    }
    
    /* Force recent orders to maintain height */
    .recent-orders {
      min-height: 300px !important;
      width: 100% !important;
      display: block !important;
    }
    
    /* Dashboard active state */
    body.admin-dashboard-active .admin-main {
      display: flex !important;
      flex-direction: column !important;
    }
  </style>

  <!-- Razorpay checkout script -->
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <app-root></app-root>

  <script>
    // Add admin-view class to body for admin routes
    (function() {
      function checkAdminRoute() {
        if (window.location.pathname.startsWith('/admin') && 
            window.location.pathname !== '/admin/dev-login') {
          document.body.classList.add('admin-view');
          
          // Force visibility for any hidden elements - fix for white screen
          setTimeout(function() {
            var dashboard = document.querySelector('.dashboard');
            if (dashboard) {
              dashboard.classList.add('force-visible');
              
              var statsGrid = dashboard.querySelector('.stats-grid');
              if (statsGrid) statsGrid.classList.add('force-grid');
              
              var recentOrders = dashboard.querySelector('.recent-orders');
              if (recentOrders) recentOrders.classList.add('force-visible');
              
              var statsCards = dashboard.querySelectorAll('.stats-card');
              statsCards.forEach(function(card) {
                card.classList.add('force-flex');
              });
            }
            
            var productList = document.querySelector('.product-list');
            if (productList) {
              productList.classList.add('force-visible');
            }
          }, 100);
        } else {
          document.body.classList.remove('admin-view');
        }
      }
      
      // Check on initial load
      document.addEventListener('DOMContentLoaded', checkAdminRoute);
      
      // Check when route changes
      let lastUrl = window.location.href;
      new MutationObserver(() => {
        const url = window.location.href;
        if (url !== lastUrl) {
          lastUrl = url;
          checkAdminRoute();
        }
      }).observe(document, {subtree: true, childList: true});
      
      // Add additional check after Angular has fully loaded
      window.addEventListener('load', function() {
        setTimeout(checkAdminRoute, 500);
      });
    })();
  </script>

  <script>
    // Ultra-aggressive dashboard fix that runs immediately
    document.addEventListener('DOMContentLoaded', function() {
      // Function to fix dashboard visibility issues
      function fixDashboardVisibility() {
        // console.log('Running dashboard visibility fix');
        
        // Make sure admin dashboard is visible
        const style = document.createElement('style');
        style.textContent = `
          app-root, app-admin-layout, app-admin-dashboard, .dashboard, .admin-main, .admin-container {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            min-height: 100px !important;
          }
          
          app-admin-dashboard {
            width: 100% !important;
          }
          
          .dashboard {
            width: 100% !important;
            max-width: 100% !important;
            padding: 30px !important;
            background-color: #fff !important;
            min-height: 600px !important;
            border: 1px solid #eee !important;
            position: relative !important;
            z-index: 999 !important;
          }
          
          .stats-grid {
            display: grid !important;
            grid-template-columns: repeat(3, 1fr) !important;
            gap: 30px !important;
            margin-bottom: 40px !important;
            width: 100% !important;
          }
          
          .stats-card {
            display: flex !important;
            flex-direction: column !important;
            padding: 40px 30px !important;
            border: 1px solid #eee !important;
          }
          
          .recent-orders {
            width: 100% !important;
            padding: 30px !important;
            border: 1px solid #eee !important;
            display: block !important;
          }
          
          /* Force all Angular components to be visible */
          [ng-version] > * {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
          }
          
          /* Utility classes to force visibility */
          .force-visible { display: block !important; visibility: visible !important; opacity: 1 !important; }
          .force-grid { display: grid !important; }
          .force-flex { display: flex !important; }
        `;
        document.head.appendChild(style);
        
        // Run the check again after a delay
        setTimeout(fixDashboardVisibility, 1000);
      }
      
      // Run immediately
      fixDashboardVisibility();
      
      // Also run after Angular has likely bootstrapped (2 seconds)
      setTimeout(fixDashboardVisibility, 2000);
      
      // Create an emergency fallback dashboard if needed
      setTimeout(function() {
        const urlPath = window.location.pathname;
        if (urlPath.includes('/admin/dashboard') && !document.querySelector('.emergency-dashboard')) {
          const adminMain = document.querySelector('.admin-main') || document.querySelector('app-admin-dashboard');
          
          if (adminMain) {
            console.log('Creating emergency dashboard fallback');
            const emergencyDashboard = document.createElement('div');
            emergencyDashboard.className = 'emergency-dashboard';
            emergencyDashboard.innerHTML = `
              <div style="width: 100%; padding: 30px; background: #fff; min-height: 600px; border: 1px solid #eee; position: relative; z-index: 9999;">
                <h2 style="font-size: 24px; margin-bottom: 40px;">Dashboard</h2>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; margin-bottom: 40px;">
                  <div style="padding: 40px; text-align: center; border: 1px solid #eee;">
                    <h3 style="font-size: 48px; margin: 0 0 10px;">0</h3>
                    <p style="margin: 0; font-size: 12px; text-transform: uppercase; color: #999;">Products</p>
                  </div>
                  
                  <div style="padding: 40px; text-align: center; border: 1px solid #eee;">
                    <h3 style="font-size: 48px; margin: 0 0 10px;">0</h3>
                    <p style="margin: 0; font-size: 12px; text-transform: uppercase; color: #999;">Orders</p>
                  </div>
                  
                  <div style="padding: 40px; text-align: center; border: 1px solid #eee;">
                    <h3 style="font-size: 48px; margin: 0 0 10px;">0</h3>
                    <p style="margin: 0; font-size: 12px; text-transform: uppercase; color: #999;">Users</p>
                  </div>
                </div>
                
                <div style="border: 1px solid #eee; padding: 30px; width: 100%;">
                  <h3 style="margin-top: 0; margin-bottom: 30px; font-size: 16px; text-transform: uppercase;">Recent Orders</h3>
                  <p style="text-align: center; padding: 40px; color: #999;">Loading orders data...</p>
                </div>
              </div>
            `;
            
            adminMain.appendChild(emergencyDashboard);
          }
        }
      }, 3000);
    });
  </script>
  
  <!-- Anti-shrink dashboard script -->
  <script>
    // Fixes the dashboard shrinking issue when data loads
    (function() {
      let isAdminDashboard = false;
      
      // Add a property to window to track the observer
      window._dashboardObserver = null;
      
      function fixDashboardShrinking() {
        // Check if we're on the admin dashboard page
        if (window.location.pathname.includes('/admin/dashboard')) {
          isAdminDashboard = true;
          
          // Add a specific class to the body
          document.body.classList.add('admin-dashboard-page');
          
          // Apply the fix when DOM is fully loaded
          const applyFix = () => {
            // console.log('Applying anti-shrink dashboard fix');
            
            // Fix flex layout for all parent containers
            const containers = [
              'app-root', 
              'app-admin-layout', 
              '.admin-layout', 
              '.admin-content', 
              '.admin-main', 
              'app-admin-dashboard', 
              '.dashboard',
              '.stable-content'
            ];
            
            containers.forEach(selector => {
              const elements = document.querySelectorAll(selector);
              elements.forEach(el => {
                if (el) {
                  el.style.display = 'flex';
                  el.style.flexDirection = 'column';
                  el.style.flex = '1 1 auto';
                  el.style.minHeight = '0'; // Critical for nested flex containers
                  el.style.width = '100%';
                  el.style.maxWidth = '100%';
                  el.style.boxSizing = 'border-box';
                }
              });
            });
            
            // Fix specific elements
            const dashboard = document.querySelector('.dashboard');
            if (dashboard) {
              dashboard.style.flexGrow = '1';
              dashboard.style.flexShrink = '0';
              dashboard.style.flexBasis = 'auto';
            }
            
            // Fix stats grid
            const statsGrid = document.querySelector('.stats-grid');
            if (statsGrid) {
              statsGrid.style.display = 'grid';
              statsGrid.style.gridTemplateColumns = 'repeat(3, 1fr)';
              statsGrid.style.width = '100%';
              statsGrid.style.flexShrink = '0';
            }
            
            // Fix recent orders
            const recentOrders = document.querySelector('.recent-orders');
            if (recentOrders) {
              recentOrders.style.width = '100%';
              recentOrders.style.flexShrink = '0';
            }
            
            // Setup mutation observer to watch for changes and reapply the fix
            const dashboardContainer = document.querySelector('app-admin-dashboard') || document.querySelector('.admin-main');
            if (dashboardContainer && !window._dashboardObserver) {
              window._dashboardObserver = new MutationObserver((mutations) => {
                // If dashboard is loading or content changes, reapply the fix
                const needsReapply = mutations.some(mutation => 
                  mutation.type === 'attributes' || 
                  mutation.type === 'childList' || 
                  (mutation.type === 'characterData' && mutation.target.parentElement && 
                   mutation.target.parentElement.closest('.dashboard'))
                );
                
                if (needsReapply) {
                  // console.log('Dashboard changed - reapplying fix');
                  setTimeout(applyFix, 50);
                }
              });
              
              window._dashboardObserver.observe(dashboardContainer, {
                attributes: true,
                childList: true,
                subtree: true,
                characterData: true
              });
              
              console.log('Setup dashboard mutation observer');
            }
          };
          
          // Apply immediately and after small delay
          applyFix();
          setTimeout(applyFix, 100);
          setTimeout(applyFix, 500);
          setTimeout(applyFix, 1000);
          
          // Also apply when window is resized
          window.addEventListener('resize', applyFix);
        } else if (isAdminDashboard) {
          // Cleanup when leaving dashboard
          isAdminDashboard = false;
          document.body.classList.remove('admin-dashboard-page');
          
          // Disconnect observer if exists
          if (window._dashboardObserver) {
            window._dashboardObserver.disconnect();
            window._dashboardObserver = null;
            console.log('Disconnected dashboard observer');
          }
          
          // Remove resize listener
          window.removeEventListener('resize', fixDashboardShrinking);
        }
      }
      
      // Run when DOM is loaded
      document.addEventListener('DOMContentLoaded', fixDashboardShrinking);
      
      // Also check when route changes
      let lastUrl = window.location.href;
      new MutationObserver(() => {
        const url = window.location.href;
        if (url !== lastUrl) {
          lastUrl = url;
          setTimeout(fixDashboardShrinking, 50);
        }
      }).observe(document, {subtree: true, childList: true});
    })();
  </script>
</body>
</html>
